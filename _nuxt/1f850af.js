(window.webpackJsonp=window.webpackJsonp||[]).push([[7,4],{513:function(t,e,n){var content=n(521);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(18).default)("6f996a7b",content,!0,{sourceMap:!1})},520:function(t,e,n){"use strict";n(513)},521:function(t,e,n){var r=n(17)(!1);r.push([t.i,".card-sub-title{padding:0}.card-subtitle{color:#fff}",""]),t.exports=r},522:function(t,e,n){"use strict";n.r(e);var r=n(305),o=n(224),c=n(89),l=n(550),d=n(505),m=n(491),v=n(20),f=(n(60),n(65),n(236)),h=n(124),_={mixins:[f.validationMixin],props:{closeDialog:{type:Function},createPoint:{type:Function}},validations:{pointName:{required:h.required},authorName:{required:h.required}},data:function(){return{pointName:"",authorName:"",authors:["Шербол","Бекжан","Эржан","Адилет"]}},computed:{pointNameErrors:function(){var t=[];return this.$v.pointName.$dirty?(!this.$v.pointName.required&&t.push('Поле "Название торговой точки" не должно быть пустым!'),t):t},authorNameErrors:function(){var t=[];return this.$v.authorName.$dirty?(!this.$v.authorName.required&&t.push('Поле "Имя автора" не должно быть пустым!'),t):t}},mounted:function(){},methods:{save:function(){var t=this;return Object(v.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$v.$touch(),t.$v.$invalid){e.next=5;break}return e.next=4,t.createPoint({pointName:t.pointName.trim(),authorName:t.authorName.trim()});case 4:t.close();case 5:case"end":return e.stop()}}),e)})))()},close:function(){this.$v.$reset(),this.pointName="",this.authorName="",this.closeDialog()}}},P=n(63),component=Object(P.a)(_,(function(){var t=this,e=t._self._c;return e("form",[e(o.a,[e(c.d,[e("span",{staticClass:"text-h5"},[t._v("Добавить торговую точку")])]),t._v(" "),e(c.c,[e(m.a,{attrs:{"error-messages":t.pointNameErrors,label:"Название торговой точки",required:""},on:{input:function(e){return t.$v.pointName.$touch()},blur:function(e){return t.$v.pointName.$touch()}},model:{value:t.pointName,callback:function(e){t.pointName=e},expression:"pointName"}}),t._v(" "),e(l.a,{attrs:{"error-messages":t.authorNameErrors,label:"Имя автора",placeholder:"Если вашего имени нет в списке, можете написать своё.",required:"",clearable:"",items:t.authors},on:{input:function(e){return t.$v.authorName.$touch()},blur:function(e){return t.$v.authorName.$touch()}},model:{value:t.authorName,callback:function(e){t.authorName=e},expression:"authorName"}})],1),t._v(" "),e(c.a,[e(d.a),t._v(" "),e(r.a,{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v(" Закрыть ")]),t._v(" "),e(r.a,{attrs:{color:"blue darken-1",text:""},on:{click:t.save}},[t._v(" Сохранить ")])],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports},523:function(t,e,n){"use strict";n.r(e);var r=n(305),o=n(224),c=n(89),l=n(505),d=(n(517),n(29),{props:{closeDialog:{type:Function},selectedPoint:{type:Object},deletePoint:{type:Function}},computed:{formattedDateTime:function(){var t=function(t){return String(t).padStart(2,"0")},e=new Date(this.selectedPoint.createdAt),n=e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),r="".concat(t(e.getHours()),":").concat(t(e.getMinutes()),":").concat(t(e.getSeconds()));return"".concat(n," ").concat(r)}}}),m=(n(520),n(63)),component=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e(o.a,[e(c.d,[e("span",{staticClass:"font-weight-bold text-h5"},[t._v("Информация о торговой точке")])]),t._v(" "),e(c.c,[e(c.b,{staticClass:"card-sub-title card-title mt-6"},[e("span",[t._v("ID:")])]),t._v(" "),e(c.d,{staticClass:"card-sub-title card-subtitle"},[e("span",[t._v("\n        "+t._s(t.selectedPoint.id)+"\n      ")])]),t._v(" "),e(c.b,{staticClass:"card-sub-title card-title mt-5"},[e("span",[t._v("Название:")])]),t._v(" "),e(c.d,{staticClass:"card-sub-title card-subtitle"},[e("span",[t._v("\n        "+t._s(t.selectedPoint.pointName)+"\n      ")])]),t._v(" "),e(c.b,{staticClass:"card-sub-title card-title mt-5"},[e("span",[t._v("Автор:")])]),t._v(" "),e(c.d,{staticClass:"card-sub-title card-subtitle"},[e("span",[t._v("\n        "+t._s(t.selectedPoint.authorName)+"\n      ")])]),t._v(" "),e(c.b,{staticClass:"card-sub-title card-title mt-5"},[e("span",[t._v("Время создания:")])]),t._v(" "),e(c.d,{staticClass:"card-sub-title card-subtitle"},[e("span",[t._v("\n        "+t._s(t.formattedDateTime)+"\n      ")])]),t._v(" "),e(c.b,{staticClass:"card-sub-title card-title mt-5"},[e("span",[t._v("Координаты:")])]),t._v(" "),e(c.d,{staticClass:"card-sub-title card-subtitle"},[e("span",[t._v("\n        "+t._s(t.selectedPoint.latlng)+"\n      ")])])],1),t._v(" "),e(c.a,[e(l.a),t._v(" "),e(r.a,{attrs:{color:"red darken-1",text:""},on:{click:function(){return t.deletePoint(t.selectedPoint.id)}}},[t._v("\n      Удалить\n    ")]),t._v(" "),e(r.a,{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDialog}},[t._v(" Закрыть ")])],1)],1)}),[],!1,null,null,null);e.default=component.exports},526:function(t,e,n){t.exports=n.p+"img/user.ce7bb95.png"},551:function(t,e,n){"use strict";n.r(e);var r=n(547),o=n(506),c=n(504),l=n(20),d=(n(5),n(10),n(11),n(60),n(3)),m=n(526),v=n.n(m),f=n(527),h=n.n(f),_=n(522),P=n(523),N={layout:"client",components:{LMovingMarker:h.a,AddNewPoint:_.default,ViewPointDetails:P.default},data:function(){return{isCreatePointDialogOpen:!1,isViewPointDetailsDialogOpen:!1,points:[],createdPointLatLng:null,selectedPoint:null,user:{location:Object(d.latLng)(42.870454,74.598038),icon:Object(d.icon)({iconUrl:v.a,iconSize:[32,32]})},zoom:13,minZoom:6,attribution:'&copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}},mounted:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.fetchPoints(),t.watchId=navigator.geolocation.watchPosition((function(e){t.user.location=Object(d.latLng)(e.coords.latitude,e.coords.longitude)}));case 2:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){navigator.geolocation.clearWatch(this.watchId)},methods:{fetchPoints:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$fire.firestore.collection("points").get();case 2:e.sent.docs.forEach((function(e){var n=e.data(),r=n.latlng,o={id:e.id,pointName:n.pointName,authorName:n.authorName,createdAt:n.createdAt,latlng:Object(d.latLng)(r.latitude,r.longitude)};t.points.push(o)}));case 4:case"end":return e.stop()}}),e)})))()},createPoint:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var r,o,c,l,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.pointName,o=t.authorName,c=Date.now(),l={latitude:e.createdPointLatLng.lat,longitude:e.createdPointLatLng.lng},m={pointName:r,authorName:o,createdAt:c,latlng:l},n.prev=4,n.next=7,e.$fire.firestore.collection("points").add(m);case 7:v=n.sent,e.points.push({id:v.id,pointName:r,authorName:o,createdAt:c,latlng:Object(d.latLng)(l.latitude,l.longitude)}),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(4),console.error("Firebase error: ".concat(n.t0)),alert("Firebase error: ".concat(n.t0));case 15:case"end":return n.stop()}}),n,null,[[4,11]])})))()},deletePoint:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$fire.firestore.collection("points").doc(t).delete();case 3:e.points=e.points.filter((function(e){return e.id!=t})),e.isViewPointDetailsDialogOpen=!1,n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("Firebase error: ".concat(n.t0)),alert("Firebase error: ".concat(n.t0));case 11:case"end":return n.stop()}}),n,null,[[0,7]])})))()},viewPointDetails:function(t){this.selectedPoint=t,this.isViewPointDetailsDialogOpen=!0}}},w=n(63),component=Object(w.a)(N,(function(){var t=this,e=t._self._c;return e(c.a,[e(r.a,[e("l-map",{staticStyle:{height:"100vh"},attrs:{"min-zoom":t.minZoom,zoom:t.zoom,center:t.user.location,options:{zoomControl:!1}},on:{contextmenu:function(e){t.isCreatePointDialogOpen=!0,t.createdPointLatLng=e.latlng}}},[e("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t._v(" "),e("l-marker",{attrs:{"lat-lng":t.user.location,icon:t.user.icon,duration:2e3,options:{pan:!1}}}),t._v(" "),t._l(t.points,(function(n){return e("l-marker",{key:n.id,attrs:{"lat-lng":n.latlng},on:{click:function(){return t.viewPointDetails(n)}}})}))],2),t._v(" "),e(o.a,{staticStyle:{"z-index":"10000"},attrs:{persistent:"","max-width":"600px"},model:{value:t.isCreatePointDialogOpen,callback:function(e){t.isCreatePointDialogOpen=e},expression:"isCreatePointDialogOpen"}},[e("add-new-point",{attrs:{closeDialog:function(){return t.isCreatePointDialogOpen=!1},createPoint:t.createPoint}})],1),t._v(" "),e(o.a,{staticStyle:{"z-index":"10000"},attrs:{persistent:"","max-width":"600px"},model:{value:t.isViewPointDetailsDialogOpen,callback:function(e){t.isViewPointDetailsDialogOpen=e},expression:"isViewPointDetailsDialogOpen"}},[e("view-point-details",{attrs:{closeDialog:function(){return t.isViewPointDetailsDialogOpen=!1},selectedPoint:t.selectedPoint,deletePoint:t.deletePoint}})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{AddNewPoint:n(522).default,ViewPointDetails:n(523).default})}}]);